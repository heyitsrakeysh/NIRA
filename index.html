<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIRA - PB & NI Performance Evaluation System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
        }

        [data-theme="dark"] {
            --primary-color: #60a5fa;
            --secondary-color: #34d399;
            --accent-color: #fbbf24;
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border-color: #374151;
        }

        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        .professional-font {
            font-family: 'Roboto', sans-serif;
        }

        .bg-primary {
            background-color: var(--bg-primary);
        }

        .bg-secondary {
            background-color: var(--bg-secondary);
        }

        .text-primary {
            color: var(--text-primary);
        }

        .text-secondary {
            color: var(--text-secondary);
        }

        .border-custom {
            border-color: var(--border-color);
        }

        /* Animated Quote Banner */
        .quotes-banner {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 12px;
            text-align: center;
            font-weight: 500;
            animation: slideText 6s infinite;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            font-size: 12px;
        }

        @keyframes slideText {
            0%, 15% { opacity: 1; transform: translateY(0); }
            85%, 100% { opacity: 1; transform: translateY(0); }
        }

        /* Medal Styles */
        .medal {
            font-size: 2rem;
            margin-bottom: 8px;
            display: block;
        }

        .medal-small {
            font-size: 1.2rem;
            margin-right: 6px;
        }

        /* Winner Cards */
        .winner-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 12px;
            padding: 20px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .winner-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        /* Score Summary Boxes */
        .score-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            padding: 16px;
            color: white;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .score-box:hover {
            transform: translateY(-3px);
        }

        /* Medal Display in Reports */
        .medal-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            margin: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
            min-height: 120px;
        }

        .medal-display.first {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1f2937;
        }

        .medal-display.second {
            background: linear-gradient(135deg, #c0c0c0 0%, #e5e7eb 100%);
            color: #1f2937;
        }

        .medal-display.third {
            background: linear-gradient(135deg, #cd7f32 0%, #d97706 100%);
            color: white;
        }

        /* Nira Bot */
        .nira-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #06d6a0, #118ab2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .story-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 16px;
            color: white;
            margin: 8px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 220px;
            margin: 15px 0;
        }

        /* Input Validation */
        .invalid-input {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
        }

        .valid-input {
            border-color: #10b981 !important;
            background-color: #f0fdf4 !important;
        }

        /* Ranking Cards */
        .ranking-card {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s ease;
            margin-bottom: 6px;
        }

        .ranking-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: relative;
            width: 50px;
            height: 25px;
            background: #374151;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .theme-toggle {
            background: #3b82f6;
        }

        [data-theme="dark"] .theme-toggle::before {
            transform: translateX(25px);
        }

        /* Custom Calendar Styles */
        .calendar-container {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1000;
            min-width: 260px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }

        .calendar-day {
            padding: 6px;
            text-align: center;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .calendar-day:hover {
            background: var(--primary-color);
            color: white;
        }

        .calendar-day.selected {
            background: var(--primary-color);
            color: white;
        }

        /* Form Controls */
        input, select, textarea {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            border-color: var(--border-color);
            transition: all 0.3s ease;
            font-size: 14px;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), #1d4ed8);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        /* Settings Dropdown */
        .settings-dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: var(--bg-primary);
            min-width: 280px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            z-index: 1000;
            padding: 16px;
        }

        .dropdown-content.show {
            display: block;
        }

        /* Loading Animation */
        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Single Page Layout Optimization */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .section-card {
            background: var(--bg-primary);
            border-radius: 10px;
            padding: 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            break-inside: avoid;
        }

        .compact-section {
            padding: 12px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Date section styling */
        .date-section {
            background: #3b82f6;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            font-size: 14px;
        }

        /* Compact table styling */
        table {
            font-size: 0.8rem;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Signature */
        .signature {
            text-align: center;
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 20px;
            padding: 8px;
            border-top: 1px solid var(--border-color);
        }

        /* PDF Optimizations */
        @media print {
            .quotes-banner { display: none; }
            .no-print { display: none !important; }
            body { background: white; color: black; margin: 0; }
            .bg-primary, .bg-secondary { background: white !important; }
            .text-primary, .text-secondary { color: black !important; }
            .section-card { box-shadow: none; }
            .main-content { gap: 12px; }
            .chart-container { height: 180px; }
        }

        /* Email client detection styles */
        .email-options {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            z-index: 1000;
            min-width: 200px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .email-options.show {
            display: block;
        }

        .email-option {
            display: block;
            width: 100%;
            padding: 8px 12px;
            text-align: left;
            border: none;
            background: none;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 4px;
            transition: all 0.2s ease;
        }

        .email-option:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Import/Export Options */
        .import-export-options {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            z-index: 1000;
            min-width: 180px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .import-export-options.show {
            display: block;
        }

        .import-export-option {
            display: block;
            width: 100%;
            padding: 8px 12px;
            text-align: left;
            border: none;
            background: none;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 4px;
            transition: all 0.2s ease;
        }

        .import-export-option:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Tips & Help Styling */
        .tip-card {
            background: #efefef;
            border-left: 4px solid var(--primary-color);
            padding: 16px;
            margin: 12px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .tip-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .tip-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tip-content {
            color: #6b7280;
            line-height: 1.5;
            font-size: 14px;
        }
        
        }

        html[data-theme="dark"] .tip-content {
            color: #000;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container { padding: 8px; }
            .quotes-banner { font-size: 10px; padding: 6px; }
            .chart-container { height: 200px; }
            .chart-grid { grid-template-columns: 1fr; }
            .section-card { padding: 12px; }
            .section-title { font-size: 1.1rem; }
            .winner-card { padding: 16px; }
            .medal { font-size: 1rem; }
            table { font-size: 0.7rem; }
            .btn-primary, .btn-secondary { padding: 6px 12px; font-size: 12px; }
            .score-box { padding: 12px; }
            .story-container { min-height: 80px; padding: 12px; }
            .nira-avatar { width: 40px; height: 40px; font-size: 16px; }
            
            /* Stack header elements on mobile */
            .header-content { flex-direction: column; gap: 12px; }
            .header-actions { flex-wrap: wrap; gap: 8px; justify-content: center; }
            
            /* Responsive tables */
            .table-container { overflow-x: auto; }
            .table-container table { min-width: 600px; }
            
            /* Responsive calendar */
            .calendar-container { min-width: 240px; right: 0; left: auto; }
        }

        @media (max-width: 480px) {
            .container { padding: 4px; }
            .section-card { padding: 8px; }
            .grid { grid-template-columns: 1fr !important; }
            .btn-primary, .btn-secondary { padding: 4px 8px; font-size: 11px; }
            .winner-card { padding: 12px; }
            .score-box { padding: 8px; }
            table { font-size: 0.65rem; }
            input, select { font-size: 12px; padding: 4px; }
        }

        /* Desktop optimization for single page view */
        @media (min-width: 1024px) {
            .chart-grid { grid-template-columns: 1fr 1fr; }
            .main-content { gap: 20px; }
        }
    </style>
</head>
<body>
    <!-- Floating Motivational Quotes Banner -->
    <div id="quotes-banner" class="quotes-banner">
        "Excellence is never an accident. It is always the result of high intention, sincere effort, and intelligent execution."
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-2 py-4 mt-12">
        <!-- Header -->
        <header class="section-card mb-4">
            <div class="header-content flex justify-between items-center flex-wrap gap-4">
                <div class="flex items-center space-x-3">
                    <!-- NIRA Logo -->
                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">NIRA</span>
                    </div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold text-primary professional-font">
                            PB & NI Performance Evaluation System
                        </h1>
                        <p class="text-secondary text-xs">Professional Assessment & Innovation Platform</p>
                    </div>
                </div>
                <div class="header-actions flex items-center space-x-2 flex-wrap">
                    <!-- Custom Calendar -->
                    <div class="relative">
                        <button onclick="toggleCalendar()" class="date-section">
                            <i class="fas fa-calendar-alt mr-1"></i>
                            <span id="evaluation-month-display">May 2025</span>
                        </button>
                        <div id="calendar-container" class="calendar-container" style="display: none;">
                            <div class="calendar-header">
                                <button onclick="prevMonth()" class="btn-secondary text-xs"><i class="fas fa-chevron-left"></i></button>
                                <div>
                                    <select id="month-select" onchange="updateCalendar()" class="text-xs">
                                        <option value="0">January</option>
                                        <option value="1">February</option>
                                        <option value="2">March</option>
                                        <option value="3">April</option>
                                        <option value="4" selected>May</option>
                                        <option value="5">June</option>
                                        <option value="6">July</option>
                                        <option value="7">August</option>
                                        <option value="8">September</option>
                                        <option value="9">October</option>
                                        <option value="10">November</option>
                                        <option value="11">December</option>
                                    </select>
                                    <input type="number" id="year-select" value="2025" min="2020" max="2030" onchange="updateCalendar()" class="w-16 ml-1 p-1 border rounded text-xs">
                                </div>
                                <button onclick="nextMonth()" class="btn-secondary text-xs"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-grid">
                                <div class="text-xs font-bold text-center py-1">Sun</div>
                                <div class="text-xs font-bold text-center py-1">Mon</div>
                                <div class="text-xs font-bold text-center py-1">Tue</div>
                                <div class="text-xs font-bold text-center py-1">Wed</div>
                                <div class="text-xs font-bold text-center py-1">Thu</div>
                                <div class="text-xs font-bold text-center py-1">Fri</div>
                                <div class="text-xs font-bold text-center py-1">Sat</div>
                            </div>
                        </div>
                    </div>

                    <!-- Import Data Button -->
                    <div class="relative">
                        <button onclick="toggleImportOptions()" class="btn-primary bg-blue-600 hover:bg-blue-700 no-print">
                            <i class="fas fa-file-import mr-1"></i>Import Data
                        </button>
                        <div id="import-options" class="import-export-options">
                            <button onclick="importData('json')" class="import-export-option">
                                <i class="fas fa-file-code mr-2"></i>Import JSON
                            </button>
                            <button onclick="importData('excel')" class="import-export-option">
                                <i class="fas fa-file-excel mr-2"></i>Import Excel
                            </button>
                            <button onclick="importData('csv')" class="import-export-option">
                                <i class="fas fa-file-csv mr-2"></i>Import CSV
                            </button>
                        </div>
                    </div>

                    <!-- Export Data Button -->
                    <div class="relative">
                        <button onclick="toggleExportOptions()" class="btn-primary bg-green-600 hover:bg-green-700 no-print">
                            <i class="fas fa-file-export mr-1"></i>Export Data
                        </button>
                        <div id="export-options" class="import-export-options">
                            <button onclick="exportData('json')" class="import-export-option">
                                <i class="fas fa-file-code mr-2"></i>Export JSON
                            </button>
                            <button onclick="exportData('excel')" class="import-export-option">
                                <i class="fas fa-file-excel mr-2"></i>Export Excel
                            </button>
                            <button onclick="exportData('csv')" class="import-export-option">
                                <i class="fas fa-file-csv mr-2"></i>Export CSV
                            </button>
                        </div>
                    </div>

                    <!-- Settings Dropdown -->
                    <div class="settings-dropdown no-print">
                        <button onclick="toggleSettings()" class="btn-primary">
                            <i class="fas fa-cog mr-1"></i>Settings
                        </button>
                        <div id="settings-dropdown" class="dropdown-content">
                            <h3 class="font-bold text-base mb-3">Settings</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-xs font-medium mb-1">Email Recipient</label>
                                    <input type="email" id="email-recipient" value="rakesh.suthar@performics.com" class="w-full p-2 border border-custom rounded-lg text-xs">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium mb-1">Team Management</label>
                                    <button onclick="openTeamManager()" class="btn-secondary w-full">
                                        <i class="fas fa-users mr-1"></i>Manage Teams
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium mb-1">Display Options</label>
                                    <div class="flex flex-col space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="show-pb-criteria" checked onchange="toggleCriteriaDisplay('pb')" class="mr-2">
                                            <span class="text-xs">Show PB Criteria</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="show-ni-criteria" checked onchange="toggleCriteriaDisplay('ni')" class="mr-2">
                                            <span class="text-xs">Show NI Criteria</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Theme Toggle -->
                    <div class="theme-toggle no-print" onclick="toggleTheme()"></div>

                    <!-- Email Report Button -->
                    <div class="relative">
                        <button onclick="toggleEmailOptions()" class="btn-primary no-print">
                            <i class="fas fa-envelope mr-1"></i>Email Report
                        </button>
                        <div id="email-options" class="email-options">
                            <button onclick="emailReport('outlook')" class="email-option">
                                <i class="fas fa-envelope mr-2"></i>Outlook
                            </button>
                            <button onclick="emailReport('gmail')" class="email-option">
                                <i class="fas fa-envelope mr-2"></i>Gmail
                            </button>
                            <button onclick="emailReport('default')" class="email-option">
                                <i class="fas fa-envelope mr-2"></i>Default Email App
                            </button>
                        </div>
                    </div>

                    <!-- Print Report Button -->
                    <button onclick="printReport()" class="btn-primary no-print bg-green-600 hover:bg-green-700">
                        <i class="fas fa-print mr-1"></i>Print Report
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Layout -->
        <div class="main-content">
            <!-- About the Process Section -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-info-circle text-blue-600"></i>About the Evaluation Process
                </h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-primary">Playbook (PB) Evaluation</h3>
                        <div class="text-sm text-secondary space-y-2">
                            <p><strong>Purpose:</strong> Evaluate strategic thinking, creativity, and practical implementation approaches in team playbooks.</p>
                            <p><strong>Focus Areas:</strong> Originality, clarity of structure, real-world applicability, innovative thinking, and potential impact.</p>
                            <p><strong>Scoring:</strong> Each team's playbook is assessed on a 100-point scale across five key criteria.</p>
                            <p><strong>Timeline:</strong> Monthly evaluation cycle with submissions due by month-end for review.</p>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-primary">Notes & Insights (NI) Evaluation</h3>
                        <div class="text-sm text-secondary space-y-2">
                            <p><strong>Purpose:</strong> Assess analytical depth, data-driven insights, and actionable recommendations.</p>
                            <p><strong>Focus Areas:</strong> Quality of analysis, clarity of insights, data visualization, recommendation relevance, and presentation effectiveness.</p>
                            <p><strong>Scoring:</strong> Comprehensive 100-point evaluation emphasizing depth and practical value.</p>
                            <p><strong>Deliverables:</strong> Teams submit detailed analysis reports with supporting data and visualizations.</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-black-50 rounded-lg">
                    <h4 class="font-semibold text-primary mb-2">Evaluation Principles</h4>
                    <div class="text-sm text-secondary grid md:grid-cols-3 gap-4">
                        <div><strong>Fairness:</strong> Consistent evaluation criteria applied across all teams</div>
                        <div><strong>Transparency:</strong> Clear scoring methodology and feedback provided</div>
                        <div><strong>Growth-Oriented:</strong> Focus on development and continuous improvement</div>
                    </div>
                </div>
            </div>

            <!-- Tips & Help Section -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-lightbulb text-yellow-500"></i>Tips & Help - Improve Your PB & NI Performance
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- PB Tips -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary flex items-center">
                            <i class="fas fa-book mr-2"></i>Playbook (PB) Excellence Tips
                        </h3>
                        
                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-star text-yellow-500"></i>
                                Originality & Creativity (25%)
                            </div>
                            <div class="tip-content">
                                Look for unique approaches and fresh perspectives. Ask "Have I seen this before?" The more novel and creative your solution, the higher the score. Challenge conventional thinking and propose innovative strategies.
                            </div>
                        </div>

                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-list text-blue-500"></i>
                                Clarity & Structure (20%)
                            </div>
                            <div class="tip-content">
                                Ensure your playbook is well-organized and easy to understand. Use clear headings, logical flow, and step-by-step instructions. Make it so clear that anyone can follow and implement your strategies.
                            </div>
                        </div>

                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-bullseye text-green-500"></i>
                                Relevance & Applicability (20%)
                            </div>
                            <div class="tip-content">
                                Consider real-world applicability. Can this be implemented? Does it solve actual problems? Practical solutions that address current challenges score higher than theoretical concepts.
                            </div>
                        </div>

                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-brain text-purple-500"></i>
                                Out-of-box Thinking (20%)
                            </div>
                            <div class="tip-content">
                                Reward unconventional approaches and breakthrough thinking. Look for paradigm shifts and creative problem-solving that goes beyond traditional methods.
                            </div>
                        </div>

                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-rocket text-red-500"></i>
                                Impact Potential (15%)
                            </div>
                            <div class="tip-content">
                                Assess potential for significant positive change. Consider scalability, reach, and transformative power. Solutions with high impact potential deserve recognition.
                            </div>
                        </div>
                    </div>

                    <!-- NI Tips -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-primary flex items-center">
                            <i class="fas fa-chart-line mr-2"></i>Notes & Insights (NI) Excellence Tips
                        </h3>
                        
                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-microscope text-blue-500"></i>
                                Quality & Depth (25%)
                            </div>
                            <div class="tip-content">
                                Look for thorough analysis, comprehensive insights, and deep understanding. Surface-level observations score lower than profound discoveries that reveal hidden patterns.
                            </div>
                        </div>

                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-eye text-green-500"></i>
                                Clarity of Insights (20%)
                            </div>
                            <div class="tip-content">
                                Evaluate how clearly insights are communicated. Well-articulated findings that are easy to understand and act upon score higher than complex, unclear analysis.
                            </div>
                        </div>

                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-chart-bar text-yellow-500"></i>
                                Data & Visualizations (20%)
                            </div>
                            <div class="tip-content">
                                Assess quality and relevance of data presentation. Creative, accurate, and meaningful visualizations that enhance understanding earn top scores.
                            </div>
                        </div>

                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-hand-point-right text-purple-500"></i>
                                Relevance of Recommendations (20%)
                            </div>
                            <div class="tip-content">
                                Consider how actionable and relevant the recommendations are. Practical, implementable suggestions that address real needs score higher than generic advice.
                            </div>
                        </div>

                        <div class="tip-card">
                            <div class="tip-title">
                                <i class="fas fa-presentation text-red-500"></i>
                                Presentation & Storytelling (15%)
                            </div>
                            <div class="tip-content">
                                Evaluate narrative flow and engagement level. Compelling storytelling that makes data come alive and maintains audience interest scores higher.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- General Evaluation Tips -->
                <div class="mt-6 p-4 bg-gradient-to-r from-black-50 to-purple-50 rounded-lg">
                    <h4 class="font-semibold text-primary mb-3 flex items-center">
                        <i class="fas fa-graduation-cap mr-2"></i>Evaluator Mindset & Best Practices
                    </h4>
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <p><strong>Stay Objective:</strong> Focus on criteria, not personal preferences</p>
                            <p><strong>Be Consistent:</strong> Apply same standards to all teams</p>
                            <p><strong>Think Holistically:</strong> Consider overall package, not just individual components</p>
                        </div>
                        <div>
                            <p><strong>Reward Growth:</strong> Recognize improvement and innovative attempts</p>
                            <p><strong>Focus on Value:</strong> Ask "What value does this bring?" rather than "Is this perfect?"</p>
                            <p><strong>Celebrate Excellence:</strong> When you see exceptional work, don't hesitate to give full points</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dual Winner Display -->
            <div class="grid md:grid-cols-2 gap-4">
                <!-- PB Winner -->
                <div id="pb-winner-card" class="winner-card">
                    <div class="relative z-10">
                        <div class="text-4xl mb-3">üèÜ</div>
                        <h2 class="text-lg font-bold mb-2 professional-font">PB Champion</h2>
                        <div id="pb-winner-name" class="text-base font-semibold mb-1">Awaiting Results...</div>
                        <div id="pb-winner-score" class="text-sm mb-2">Score: 0%</div>
                        <div id="pb-winner-quote" class="italic text-xs opacity-90 mb-3">
                            "Innovation distinguishes between a leader and a follower."
                        </div>
                    </div>
                </div>

                <!-- NI Winner -->
                <div id="ni-winner-card" class="winner-card">
                    <div class="relative z-10">
                        <div class="text-4xl mb-3">üí°</div>
                        <h2 class="text-lg font-bold mb-2 professional-font">NI Champion</h2>
                        <div id="ni-winner-name" class="text-base font-semibold mb-1">Awaiting Results...</div>
                        <div id="ni-winner-score" class="text-sm mb-2">Score: 0%</div>
                        <div id="ni-winner-quote" class="italic text-xs opacity-90 mb-3">
                            "Excellence is never an accident. It is always the result of high intention, sincere effort, and intelligent execution."
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medal Rankings & Charts Section -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-medal text-yellow-500"></i>Medal Rankings & Performance Charts
                </h2>
                <div class="grid lg:grid-cols-4 gap-4">
                    <!-- PB Medal Table -->
                    <div>
                        <h3 class="text-sm font-bold text-primary mb-3">PB Rankings</h3>
                        <div id="pb-medal-table" class="space-y-1">
                            <!-- PB rankings will be populated here -->
                        </div>
                    </div>

                    <!-- NI Medal Table -->
                    <div>
                        <h3 class="text-sm font-bold text-primary mb-3">NI Rankings</h3>
                        <div id="ni-medal-table" class="space-y-1">
                            <!-- NI rankings will be populated here -->
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="lg:col-span-2">
                        <div class="chart-grid">
                            <div class="chart-container">
                                <h3 class="text-xs font-semibold mb-2 text-primary">PB Performance</h3>
                                <canvas id="pb-chart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h3 class="text-xs font-semibold mb-2 text-primary">NI Performance</h3>
                                <canvas id="ni-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Evaluator Information -->
            <div class="section-card compact-section">
                <h2 class="section-title">
                    <i class="fas fa-user-check text-blue-600"></i>Evaluator Information
                </h2>
                <div class="grid md:grid-cols-3 gap-3">
                    <input type="text" id="pb-evaluator-name" placeholder="PB Evaluator Name" class="p-2 border border-custom rounded-lg text-sm">
                    <input type="text" id="ni-evaluator-name" placeholder="NI Evaluator Name" class="p-2 border border-custom rounded-lg text-sm">
                    <input type="date" id="evaluation-date" class="p-2 border border-custom rounded-lg text-sm">
                </div>
            </div>

            <!-- PB Evaluation Section -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-book text-blue-600"></i>Playbook (PB) Evaluation
                </h2>

                <!-- PB Criteria Display -->
                <div id="pb-criteria-display" class="grid grid-cols-2 md:grid-cols-5 gap-2 mb-4 p-3 bg-blue-50 rounded-lg">
                    <div class="text-center">
                        <div class="text-xs font-semibold text-blue-800">Originality & Creativity</div>
                        <div class="text-sm font-bold text-blue-600">25%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-semibold text-blue-800">Clarity & Structure</div>
                        <div class="text-sm font-bold text-blue-600">20%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-semibold text-blue-800">Relevance & Applicability</div>
                        <div class="text-sm font-bold text-blue-600">20%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-semibold text-blue-800">Out-of-box Thinking</div>
                        <div class="text-sm font-bold text-blue-600">20%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-semibold text-blue-800">Impact Potential</div>
                        <div class="text-sm font-bold text-blue-600">15%</div>
                    </div>
                </div>

                <!-- PB Scoring Table -->
                <div class="table-container overflow-x-auto">
                    <table class="w-full border-collapse border border-custom">
                        <thead>
                            <tr class="bg-secondary">
                                <th class="p-2 text-left font-semibold text-primary border border-custom text-xs">Team</th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Originality<br><span class="text-xs">(0-25)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Clarity<br><span class="text-xs">(0-20)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Relevance<br><span class="text-xs">(0-20)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Innovation<br><span class="text-xs">(0-20)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Impact<br><span class="text-xs">(0-15)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Total</th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Comments</th>
                            </tr>
                        </thead>
                        <tbody id="pb-scoring-table">
                            <!-- PB scoring rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- NI Evaluation Section -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-lightbulb text-yellow-600"></i>Notes & Insights (NI) Evaluation
                </h2>

                <!-- NI Criteria Display -->
                <div id="ni-criteria-display" class="grid grid-cols-2 md:grid-cols-5 gap-2 mb-4 p-3 bg-yellow-50 rounded-lg">
                    <div class="text-center">
                        <div class="text-xs font-semibold text-yellow-800">Quality & Depth</div>
                        <div class="text-sm font-bold text-yellow-600">25%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-semibold text-yellow-800">Clarity of Insights</div>
                        <div class="text-sm font-bold text-yellow-600">20%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-semibold text-yellow-800">Data & Visualizations</div>
                        <div class="text-sm font-bold text-yellow-600">20%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-semibold text-yellow-800">Relevance of Recommendations</div>
                        <div class="text-sm font-bold text-yellow-600">20%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xs font-semibold text-yellow-800">Presentation & Storytelling</div>
                        <div class="text-sm font-bold text-yellow-600">15%</div>
                    </div>
                </div>

                <!-- NI Scoring Table -->
                <div class="table-container overflow-x-auto">
                    <table class="w-full border-collapse border border-custom">
                        <thead>
                            <tr class="bg-secondary">
                                <th class="p-2 text-left font-semibold text-primary border border-custom text-xs">Team</th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Quality<br><span class="text-xs">(0-25)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Clarity<br><span class="text-xs">(0-20)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Data<br><span class="text-xs">(0-20)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Recommendations<br><span class="text-xs">(0-20)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Presentation<br><span class="text-xs">(0-15)</span></th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Total</th>
                                <th class="p-2 text-center font-semibold text-primary border border-custom text-xs">Comments</th>
                            </tr>
                        </thead>
                        <tbody id="ni-scoring-table">
                            <!-- NI scoring rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports & Analytics Section -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar text-green-600"></i>Reports & Analytics
                </h2>

                <!-- Score Summary Boxes and Comparison Chart -->
                <div class="grid md:grid-cols-3 gap-4">
                    <!-- Score Summary Boxes -->
                    <div class="md:col-span-1">
                        <h3 class="text-sm font-semibold mb-2 text-primary">Team Scores Overview</h3>
                        <div class="grid grid-cols-1 gap-2" id="score-summary-boxes">
                            <!-- Score boxes will be populated here -->
                        </div>
                    </div>

                    <!-- Performance Comparison Chart -->
                    <div class="md:col-span-2">
                        <div class="chart-container bg-secondary p-3 rounded-lg">
                            <h3 class="text-sm font-semibold mb-2 text-primary">Performance Comparison</h3>
                            <canvas id="comparisonChart"></canvas>
                        </div>
                        
                        <!-- Medal Winners Display -->
                        <div class="mt-4">
                            <h4 class="text-sm font-semibold mb-3 text-primary">Overall Medal Winners</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2" id="medal-winners-display">
                                <!-- Medal winners will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Boxes Grid -->
            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-trophy text-purple-600"></i>Final Team Scores Summary
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="final-summary-boxes">
                    <!-- Summary boxes will be populated here -->
                </div>
            </div>

            <!-- Nira Story Bot -->
            <div class="section-card no-print">
                <div class="flex items-start space-x-3">
                    <div class="nira-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-3">
                            <h2 class="section-title">
                                Hi, I'm Nira! Wanna hear a story?
                            </h2>
                        </div>
                        <div id="story-container" class="story-container mb-3" style="display: none;">
                            <p id="story-text" class="text-center text-xs"></p>
                        </div>
                        <button id="story-button" onclick="getStory()" class="btn-primary bg-teal-600 hover:bg-teal-700">
                            <i class="fas fa-star mr-1"></i>Tell me a story
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signature -->
        <div class="signature">
            System designed by Rakesh Suthar
        </div>
    </div>

    <!-- Hidden Elements -->
    <input type="file" id="file-input" accept=".xlsx,.json,.csv" style="display: none;" onchange="handleFileImport(event)">

    <!-- Team Manager Modal -->
    <div id="team-manager-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-primary); padding: 24px; border-radius: 12px; width: 90%; max-width: 500px; max-height: 80%; overflow-y: auto;">
            <h3 class="text-xl font-bold mb-4">Team Management</h3>
            <div id="team-list" class="space-y-3 mb-4">
                <!-- Teams will be populated here -->
            </div>
            <div class="flex justify-between">
                <button onclick="addNewTeam()" class="btn-primary">
                    <i class="fas fa-plus mr-1"></i>Add New Team
                </button>
                <button onclick="closeTeamManager()" class="btn-secondary">
                    <i class="fas fa-times mr-1"></i>Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let charts = {};
        let currentTheme = 'light';
        let storyCount = 0;
        let currentQuoteIndex = 0;
        let currentMonth = 4; // May
        let currentYear = 2025;
        let selectedDate = new Date(2025, 4, 1); // May 2025
        let usedStories = new Set();

        // Chart.js plugins registration
        Chart.register(ChartDataLabels);

        // Updated Teams Data
        let teams = [
            {
                id: 'zeus',
                name: 'Team Zeus',
                lead: 'Awez B',
                members: ['Abhishek J', 'Apurva G', 'Chinmay A', 'Yug K'],
                color: 'blue'
            },
            {
                id: 'cronos',
                name: 'Team Cronos',
                lead: 'Rakesh S',
                members: ['Harshi K', 'Dhaavaal S', 'Bhagyashri D'],
                color: 'green'
            },
            {
                id: 'olympus',
                name: 'Team Olympus',
                lead: 'Shubham N',
                members: ['Chitra J', 'Neha R'],
                color: 'purple'
            },
            {
                id: 'phoenix',
                name: 'Team Phoenix',
                lead: 'Rahul W',
                members: ['Dhwani G', 'Osama M', 'Shreya T'],
                color: 'red'
            }
        ];

        let evaluationData = {
            pb: {},
            ni: {}
        };

        // Initialize teams data with empty values
        teams.forEach(team => {
            evaluationData.pb[team.id] = {
                scores: {
                    originality: '',
                    clarity: '',
                    relevance: '',
                    innovation: '',
                    impact: ''
                },
                total: 0,
                comments: ''
            };
            evaluationData.ni[team.id] = {
                scores: {
                    quality: '',
                    clarity: '',
                    data: '',
                    recommendations: '',
                    presentation: ''
                },
                total: 0,
                comments: ''
            };
        });

        // Enhanced Motivational Stories Collection
        const motivationalStories = [
            "A young programmer was struggling with a complex algorithm that had stumped him for weeks. Instead of giving up, he decided to take a different approach - he explained the problem to his grandmother who knew nothing about coding. As he simplified the technical jargon into everyday language, the solution suddenly became clear. Sometimes the best breakthroughs come when we step back and see problems with fresh eyes.",
            
            "There was once a team that received the lowest budget for their project while other teams got premium resources. Instead of complaining, they turned constraint into creativity. They built something so innovative and efficient that it became the company's flagship product. Their secret? They collaborated deeply, shared every idea, and turned limitations into fuel for innovation.",
            
            "A designer was tasked with creating a logo for a startup with zero budget. She could have made excuses, but instead she interviewed every single employee to understand their vision. The final design, created with free tools and pure passion, became an iconic brand symbol worth millions. Great work isn't about expensive tools - it's about understanding and caring deeply.",
            
            "Two teams were given identical projects with the same deadline. Team A divided tasks immediately and worked in isolation. Team B spent the first week just talking - sharing fears, strengths, and dreams. When the deadline came, Team A delivered a functional product. Team B delivered magic. The difference? They had built trust before they built anything else.",
            
            "A junior developer noticed a small inefficiency in the company's code that everyone else ignored. She spent her lunch breaks for three months creating a solution. Her 'small' fix ended up saving the company 2 million dollars annually. Never underestimate the power of caring about details that others overlook."
        ];

        // Motivational Quotes
        const quotes = [
            "Excellence is never an accident. It is always the result of high intention, sincere effort, and intelligent execution.",
            "The way to get started is to quit talking and begin doing. - Walt Disney",
            "Innovation distinguishes between a leader and a follower. - Steve Jobs",
            "Great teams are not made up of many well-rounded players, but of players with sharp edges.",
            "Coming together is a beginning, staying together is progress, and working together is success. - Henry Ford",
            "Teamwork makes the dream work, but vision becomes reality through hard work.",
            "Success is not final, failure is not fatal: it is the courage to continue that counts. - Winston Churchill",
            "The strength of the team is each individual member. The strength of each member is the team. - Phil Jackson",
            "Quality is not an act, it is a habit. - Aristotle",
            "Leadership is the capacity to translate vision into reality. - Warren Bennis"
        ];

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            populateTeamTables();
            initializeCharts();
            startQuoteRotation();
            setCurrentDate();
            calculateAllScores();
            updateCalendar();
            updateScoreSummaryBoxes();
            updateFinalSummaryBoxes();

            // Event listeners
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.settings-dropdown')) {
                    document.getElementById('settings-dropdown').classList.remove('show');
                }
                if (!event.target.closest('.relative')) {
                    document.getElementById('calendar-container').style.display = 'none';
                }
                if (!event.target.closest('.relative')) {
                    document.getElementById('email-options').classList.remove('show');
                    document.getElementById('import-options').classList.remove('show');
                    document.getElementById('export-options').classList.remove('show');
                }
            });
        }

        // Theme Toggle
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            setTimeout(() => {
                initializeCharts();
            }, 100);
        }

        // Import/Export Options Toggle
        function toggleImportOptions() {
            const options = document.getElementById('import-options');
            options.classList.toggle('show');
            document.getElementById('export-options').classList.remove('show');
        }

        function toggleExportOptions() {
            const options = document.getElementById('export-options');
            options.classList.toggle('show');
            document.getElementById('import-options').classList.remove('show');
        }

        // Email Options Toggle
        function toggleEmailOptions() {
            const options = document.getElementById('email-options');
            options.classList.toggle('show');
        }

        // Enhanced Email Integration
        function emailReport(clientType = 'default') {
            const recipientEmail = document.getElementById('email-recipient').value || 'rakesh.suthar@performics.com';

            // First, automatically download the JSON file
            exportData('json');

            const subject = encodeURIComponent(`NIRA PB-NI Evaluation Results - ${document.getElementById('evaluation-month-display').textContent}`);
            const body = encodeURIComponent(`Dear Team,

Thank you for your dedication to the NIRA evaluation process. Your thorough assessment and professional evaluation contribute significantly to our team development initiatives.

This email contains the evaluation results for ${document.getElementById('evaluation-month-display').textContent}. The detailed evaluation data has been automatically downloaded as a JSON file. Please attach this file to provide complete evaluation documentation.

Key Information:
‚Ä¢ Evaluation Period: ${document.getElementById('evaluation-month-display').textContent}
‚Ä¢ PB Evaluator: ${document.getElementById('pb-evaluator-name').value || '[To be specified]'}
‚Ä¢ NI Evaluator: ${document.getElementById('ni-evaluator-name').value || '[To be specified]'}
‚Ä¢ Evaluation Date: ${document.getElementById('evaluation-date').value || new Date().toISOString().split('T')[0]}

IMPORTANT: Please remember to attach the downloaded JSON file before sending this email. This file contains all the detailed scoring data, comments, and team information necessary for record-keeping and further analysis.

Best regards,
NIRA Evaluation System
Generated on ${new Date().toLocaleString()}

---
üìé Remember to attach the JSON file that was automatically downloaded!`);

            document.getElementById('email-options').classList.remove('show');

            let mailtoLink;
            switch(clientType) {
                case 'outlook':
                    mailtoLink = `mailto:${recipientEmail}?subject=${subject}&body=${body}`;
                    break;
                case 'gmail':
                    mailtoLink = `https://mail.google.com/mail/?view=cm&to=${recipientEmail}&subject=${subject}&body=${body}`;
                    break;
                default:
                    mailtoLink = `mailto:${recipientEmail}?subject=${subject}&body=${body}`;
                    break;
            }
            
            try {
                if (clientType === 'gmail') {
                    window.open(mailtoLink, '_blank');
                } else {
                    window.location.href = mailtoLink;
                }
            } catch (error) {
                window.location.href = `mailto:${recipientEmail}?subject=${subject}&body=${body}`;
            }

            alert(`JSON file downloaded! Your email client should open now. Please attach the downloaded JSON file before sending.`);
        }

        // Enhanced Print Report Function
        function printReport() {
            // Use browser's built-in print function which works better for tables with data
            const originalButtonText = event.target.innerHTML;
            event.target.innerHTML = '<i class="fas fa-spinner loading-spinner mr-1"></i>Preparing...';
            event.target.disabled = true;

            // Hide no-print elements
            const noPrintElements = document.querySelectorAll('.no-print');
            noPrintElements.forEach(el => el.style.display = 'none');

            // Small delay to ensure DOM updates
            setTimeout(() => {
                window.print();
                
                // Restore elements and button after print dialog
                setTimeout(() => {
                    noPrintElements.forEach(el => el.style.display = '');
                    event.target.innerHTML = originalButtonText;
                    event.target.disabled = false;
                }, 1000);
            }, 100);
        }

        // Calendar Functions
        function toggleCalendar() {
            const container = document.getElementById('calendar-container');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }

        function updateCalendar() {
            currentMonth = parseInt(document.getElementById('month-select').value);
            currentYear = parseInt(document.getElementById('year-select').value);
            
            const calendar = document.querySelector('.calendar-grid');
            const daysSection = calendar.querySelectorAll('.calendar-day');
            daysSection.forEach(day => day.remove());

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            for (let i = 0; i < 42; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = currentDate.getDate();
                
                if (currentDate.getMonth() !== currentMonth) {
                    dayElement.style.opacity = '0.3';
                }
                
                dayElement.onclick = () => selectDate(currentDate);
                calendar.appendChild(dayElement);
            }
        }

        function selectDate(date) {
            selectedDate = date;
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById('evaluation-month-display').textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            document.getElementById('calendar-container').style.display = 'none';
        }

        function prevMonth() {
            if (currentMonth === 0) {
                currentMonth = 11;
                currentYear--;
            } else {
                currentMonth--;
            }
            document.getElementById('month-select').value = currentMonth;
            document.getElementById('year-select').value = currentYear;
            updateCalendar();
        }

        function nextMonth() {
            if (currentMonth === 11) {
                currentMonth = 0;
                currentYear++;
            } else {
                currentMonth++;
            }
            document.getElementById('month-select').value = currentMonth;
            document.getElementById('year-select').value = currentYear;
            updateCalendar();
        }

        // Settings Functions
        function toggleSettings() {
            const dropdown = document.getElementById('settings-dropdown');
            dropdown.classList.toggle('show');
        }

        function openTeamManager() {
            populateTeamManager();
            document.getElementById('team-manager-modal').style.display = 'block';
        }

        function closeTeamManager() {
            document.getElementById('team-manager-modal').style.display = 'none';
        }

        function populateTeamManager() {
            const container = document.getElementById('team-list');
            container.innerHTML = '';
            
            teams.forEach((team, index) => {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'flex items-center justify-between p-3 bg-secondary rounded-lg';
                teamDiv.innerHTML = `
                    <div class="flex-1">
                        <div class="flex items-center space-x-3">
                            <input type="text" value="${team.name}" onchange="updateTeamName(${index}, this.value)" class="font-semibold text-primary bg-transparent border-b border-gray-300 focus:border-blue-500 text-sm">
                        </div>
                        <div class="mt-2">
                            <div class="text-xs font-medium text-secondary mb-1">Lead:</div>
                            <input type="text" value="${team.lead}" onchange="updateTeamLead(${index}, this.value)" class="text-xs text-secondary bg-transparent border-b border-gray-300 focus:border-blue-500 w-full mb-2" placeholder="Team lead">
                            <div class="text-xs font-medium text-secondary mb-1">Members:</div>
                            <input type="text" value="${team.members.join(', ')}" onchange="updateTeamMembers(${index}, this.value)" class="text-xs text-secondary bg-transparent border-b border-gray-300 focus:border-blue-500 w-full" placeholder="Team members (comma-separated)">
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="deleteTeam(${index})" class="btn-secondary text-xs text-red-600 hover:bg-red-100">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(teamDiv);
            });
        }

        function updateTeamName(index, newName) {
            if (newName.trim()) {
                teams[index].name = newName.trim();
                populateTeamTables();
                updateCharts();
                updateMedalRankings();
                updateScoreSummaryBoxes();
                updateFinalSummaryBoxes();
                updateMedalWinnersDisplay();
            }
        }

        function updateTeamLead(index, newLead) {
            if (newLead.trim()) {
                teams[index].lead = newLead.trim();
                populateTeamTables();
                updateMedalRankings();
                updateMedalWinnersDisplay();
            }
        }

        function updateTeamMembers(index, newMembers) {
            if (newMembers.trim()) {
                teams[index].members = newMembers.split(',').map(m => m.trim()).filter(m => m);
                populateTeamTables();
                updateMedalRankings();
                updateMedalWinnersDisplay();
            }
        }

        function addNewTeam() {
            const name = prompt('Enter team name:');
            if (name && name.trim()) {
                const lead = prompt('Enter team lead:');
                const members = prompt('Enter team members (comma-separated):');
                if (lead && lead.trim() && members && members.trim()) {
                    const newTeam = {
                        id: 'team_' + Date.now(),
                        name: name.trim(),
                        lead: lead.trim(),
                        members: members.split(',').map(m => m.trim()).filter(m => m),
                        color: ['blue', 'green', 'purple', 'red', 'yellow', 'indigo', 'pink'][teams.length % 7]
                    };
                    teams.push(newTeam);
                    
                    evaluationData.pb[newTeam.id] = {
                        scores: { originality: '', clarity: '', relevance: '', innovation: '', impact: '' },
                        total: 0,
                        comments: ''
                    };
                    evaluationData.ni[newTeam.id] = {
                        scores: { quality: '', clarity: '', data: '', recommendations: '', presentation: '' },
                        total: 0,
                        comments: ''
                    };
                    
                    populateTeamManager();
                    populateTeamTables();
                    updateCharts();
                    updateMedalRankings();
                    updateScoreSummaryBoxes();
                    updateFinalSummaryBoxes();
                    updateMedalWinnersDisplay();
                }
            }
        }

        function deleteTeam(index) {
            if (confirm('Are you sure you want to delete this team?')) {
                const team = teams[index];
                delete evaluationData.pb[team.id];
                delete evaluationData.ni[team.id];
                teams.splice(index, 1);
                
                populateTeamManager();
                populateTeamTables();
                updateCharts();
                updateMedalRankings();
                updateScoreSummaryBoxes();
                updateFinalSummaryBoxes();
                updateMedalWinnersDisplay();
            }
        }

        function toggleCriteriaDisplay(type) {
            const checkbox = document.getElementById(`show-${type}-criteria`);
            const display = document.getElementById(`${type}-criteria-display`);
            if (checkbox.checked) {
                display.style.display = 'grid';
            } else {
                display.style.display = 'none';
            }
        }

        // Quote Rotation
        function startQuoteRotation() {
            const banner = document.getElementById('quotes-banner');
            function showNextQuote() {
                banner.textContent = quotes[currentQuoteIndex];
                currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
            }
            showNextQuote();
            setInterval(showNextQuote, 6000);
        }

        // Set Current Date
        function setCurrentDate() {
            const today = new Date();
            document.getElementById('evaluation-date').value = today.toISOString().split('T')[0];
        }

        // Populate Team Tables
        function populateTeamTables() {
            populatePBTable();
            populateNITable();
        }

        function populatePBTable() {
            const tbody = document.getElementById('pb-scoring-table');
            tbody.innerHTML = '';
            
            teams.forEach(team => {
                const row = document.createElement('tr');
                row.className = 'border-b border-custom hover:bg-gray-50';
                row.innerHTML = `
                    <td class="p-2 font-medium text-${team.color}-600 border border-custom">
                        <div class="font-bold text-sm">${team.name}</div>
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="25" step="0.1" value="${evaluationData.pb[team.id].scores.originality}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="originality" oninput="validateInput(this, 25); calculatePBScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="20" step="0.1" value="${evaluationData.pb[team.id].scores.clarity}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="clarity" oninput="validateInput(this, 20); calculatePBScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="20" step="0.1" value="${evaluationData.pb[team.id].scores.relevance}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="relevance" oninput="validateInput(this, 20); calculatePBScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="20" step="0.1" value="${evaluationData.pb[team.id].scores.innovation}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="innovation" oninput="validateInput(this, 20); calculatePBScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="15" step="0.1" value="${evaluationData.pb[team.id].scores.impact}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="impact" oninput="validateInput(this, 15); calculatePBScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center font-bold text-sm border border-custom" id="pb-total-${team.id}">${evaluationData.pb[team.id].total.toFixed(1)}%</td>
                    <td class="p-2 border border-custom">
                        <input type="text" value="${evaluationData.pb[team.id].comments}" class="w-full p-1 border border-custom rounded text-xs" placeholder="Comments..." data-team="${team.id}" data-type="pb-comments" onchange="updateComments('${team.id}', 'pb', this.value)">
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateNITable() {
            const tbody = document.getElementById('ni-scoring-table');
            tbody.innerHTML = '';
            
            teams.forEach(team => {
                const row = document.createElement('tr');
                row.className = 'border-b border-custom hover:bg-gray-50';
                row.innerHTML = `
                    <td class="p-2 font-medium text-${team.color}-600 border border-custom">
                        <div class="font-bold text-sm">${team.name}</div>
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="25" step="0.1" value="${evaluationData.ni[team.id].scores.quality}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="quality" oninput="validateInput(this, 25); calculateNIScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="20" step="0.1" value="${evaluationData.ni[team.id].scores.clarity}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="clarity" oninput="validateInput(this, 20); calculateNIScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="20" step="0.1" value="${evaluationData.ni[team.id].scores.data}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="data" oninput="validateInput(this, 20); calculateNIScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="20" step="0.1" value="${evaluationData.ni[team.id].scores.recommendations}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="recommendations" oninput="validateInput(this, 20); calculateNIScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center border border-custom">
                        <input type="number" min="0" max="15" step="0.1" value="${evaluationData.ni[team.id].scores.presentation}" class="w-12 p-1 border border-custom rounded text-center text-xs" data-team="${team.id}" data-criterion="presentation" oninput="validateInput(this, 15); calculateNIScore('${team.id}')" placeholder="">
                    </td>
                    <td class="p-2 text-center font-bold text-sm border border-custom" id="ni-total-${team.id}">${evaluationData.ni[team.id].total.toFixed(1)}%</td>
                    <td class="p-2 border border-custom">
                        <input type="text" value="${evaluationData.ni[team.id].comments}" class="w-full p-1 border border-custom rounded text-xs" placeholder="Comments..." data-team="${team.id}" data-type="ni-comments" onchange="updateComments('${team.id}', 'ni', this.value)">
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateComments(teamId, type, value) {
            evaluationData[type][teamId].comments = value;
        }

        // Input Validation
        function validateInput(input, maxValue) {
            const value = parseFloat(input.value);
            if (isNaN(value) || value < 0 || value > maxValue) {
                input.classList.add('invalid-input');
                input.classList.remove('valid-input');
            } else {
                input.classList.remove('invalid-input');
                input.classList.add('valid-input');
            }
        }

        // Score Calculations
        function calculatePBScore(teamId) {
            const inputs = document.querySelectorAll(`input[data-team="${teamId}"]`);
            let total = 0;
            
            inputs.forEach(input => {
                if (input.dataset.criterion && !input.closest('#ni-scoring-table')) {
                    const value = parseFloat(input.value) || 0;
                    total += value;
                    evaluationData.pb[teamId].scores[input.dataset.criterion] = input.value;
                }
            });
            
            evaluationData.pb[teamId].total = total;
            document.getElementById(`pb-total-${teamId}`).textContent = total.toFixed(1) + '%';
            
            updateMedalRankings();
            updateWinnerCards();
            updateCharts();
            updateScoreSummaryBoxes();
            updateFinalSummaryBoxes();
            updateMedalWinnersDisplay();
        }

        function calculateNIScore(teamId) {
            const inputs = document.querySelectorAll(`input[data-team="${teamId}"]`);
            let total = 0;
            
            inputs.forEach(input => {
                if (input.dataset.criterion && input.closest('#ni-scoring-table')) {
                    const value = parseFloat(input.value) || 0;
                    total += value;
                    evaluationData.ni[teamId].scores[input.dataset.criterion] = input.value;
                }
            });
            
            evaluationData.ni[teamId].total = total;
            document.getElementById(`ni-total-${teamId}`).textContent = total.toFixed(1) + '%';
            
            updateMedalRankings();
            updateWinnerCards();
            updateCharts();
            updateScoreSummaryBoxes();
            updateFinalSummaryBoxes();
            updateMedalWinnersDisplay();
        }

        function calculateAllScores() {
            teams.forEach(team => {
                calculatePBScore(team.id);
                calculateNIScore(team.id);
            });
        }

        // Score Summary Boxes
        function updateScoreSummaryBoxes() {
            const container = document.getElementById('score-summary-boxes');
            container.innerHTML = '';
            
            teams.forEach((team, index) => {
                const totalScore = (evaluationData.pb[team.id].total + evaluationData.ni[team.id].total) / 2;
                const box = document.createElement('div');
                box.className = 'score-box';
                box.innerHTML = `
                    <h4 class="font-bold text-xs mb-1">${team.name}</h4>
                    <div class="text-lg font-bold">${totalScore.toFixed(1)}%</div>
                    <div class="text-xs opacity-90 mt-1">
                        PB: ${evaluationData.pb[team.id].total.toFixed(1)}% | NI: ${evaluationData.ni[team.id].total.toFixed(1)}%
                    </div>
                `;
                container.appendChild(box);
            });
        }

        // Final Summary Boxes
        function updateFinalSummaryBoxes() {
            const container = document.getElementById('final-summary-boxes');
            container.innerHTML = '';
            
            // Calculate combined scores and sort
            const teamScores = teams.map(team => ({
                ...team,
                combinedScore: (evaluationData.pb[team.id].total + evaluationData.ni[team.id].total) / 2,
                pbScore: evaluationData.pb[team.id].total,
                niScore: evaluationData.ni[team.id].total
            })).sort((a, b) => b.combinedScore - a.combinedScore);

            teamScores.forEach((team, index) => {
                const box = document.createElement('div');
                box.className = 'score-box';
                box.innerHTML = `
                    <h4 class="font-bold text-sm mb-2">${team.name}</h4>
                    <div class="text-xl font-bold mb-1">${team.combinedScore.toFixed(1)}%</div>
                    <div class="text-xs opacity-90 mb-2">
                        PB: ${team.pbScore.toFixed(1)}% | NI: ${team.niScore.toFixed(1)}%
                    </div>
                    <div class="text-xs opacity-90">
                        Lead: ${team.lead}<br>
                        ${team.members.join(', ')}
                    </div>
                `;
                container.appendChild(box);
            });
        }

        // Medal Rankings
        function updateMedalRankings() {
            updatePBMedalTable();
            updateNIMedalTable();
        }

        function updatePBMedalTable() {
            const table = document.getElementById('pb-medal-table');
            const sortedTeams = [...teams].sort((a, b) => 
                evaluationData.pb[b.id].total - evaluationData.pb[a.id].total
            );
            
            table.innerHTML = '';
            sortedTeams.forEach((team, index) => {
                const medals = ['ü•á', 'ü•à', 'ü•â', 'üèÖ'];
                const medal = index < 4 ? medals[index] : '';
                const position = index + 1;
                const score = evaluationData.pb[team.id].total.toFixed(1);
                
                const card = document.createElement('div');
                card.className = 'ranking-card flex items-center justify-between';
                card.innerHTML = `
                    <div class="flex items-center">
                        <span class="medal-small">${medal}</span>
                        <div>
                            <div class="font-semibold text-primary text-xs">${position}. ${team.name}</div>
                            <div class="text-xs text-secondary">Lead: ${team.lead}</div>
                            <div class="text-xs text-secondary">${team.members.join(', ')}</div>
                        </div>
                    </div>
                    <div class="text-sm font-bold text-primary">${score}%</div>
                `;
                table.appendChild(card);
            });
        }

        function updateNIMedalTable() {
            const table = document.getElementById('ni-medal-table');
            const sortedTeams = [...teams].sort((a, b) => 
                evaluationData.ni[b.id].total - evaluationData.ni[a.id].total
            );
            
            table.innerHTML = '';
            sortedTeams.forEach((team, index) => {
                const medals = ['ü•á', 'ü•à', 'ü•â', 'üèÖ'];
                const medal = index < 4 ? medals[index] : '';
                const position = index + 1;
                const score = evaluationData.ni[team.id].total.toFixed(1);
                
                const card = document.createElement('div');
                card.className = 'ranking-card flex items-center justify-between';
                card.innerHTML = `
                    <div class="flex items-center">
                        <span class="medal-small">${medal}</span>
                        <div>
                            <div class="font-semibold text-primary text-xs">${position}. ${team.name}</div>
                            <div class="text-xs text-secondary">Lead: ${team.lead}</div>
                            <div class="text-xs text-secondary">${team.members.join(', ')}</div>
                        </div>
                    </div>
                    <div class="text-sm font-bold text-primary">${score}%</div>
                `;
                table.appendChild(card);
            });
        }

        // Medal Winners Display
        function updateMedalWinnersDisplay() {
            const container = document.getElementById('medal-winners-display');
            if (!container) return;
            
            const teamScores = teams.map(team => ({
                ...team,
                combinedScore: (evaluationData.pb[team.id].total + evaluationData.ni[team.id].total) / 2,
                pbScore: evaluationData.pb[team.id].total,
                niScore: evaluationData.ni[team.id].total
            })).sort((a, b) => b.combinedScore - a.combinedScore);

            container.innerHTML = '';
            
            teamScores.slice(0, 4).forEach((team, index) => {
                const medals = ['ü•á', 'ü•à', 'ü•â', 'üèÖ'];
                const medalClasses = ['first', 'second', 'third', ''];
                const medal = medals[index];
                const medalClass = medalClasses[index];
                
                const display = document.createElement('div');
                display.className = `medal-display ${medalClass}`;
                display.innerHTML = `
                    <span class="medal">${medal}</span>
                    <div class="font-bold text-sm">${team.name}</div>
                    <div class="text-xs mt-1">Lead: ${team.lead}</div>
                    <div class="text-lg font-bold mt-2">${team.combinedScore.toFixed(1)}%</div>
                    <div class="text-xs opacity-80">Combined Score</div>
                `;
                container.appendChild(display);
            });
        }

        // Winner Cards
        function updateWinnerCards() {
            updatePBWinner();
            updateNIWinner();
        }

        function updatePBWinner() {
            const sortedTeams = [...teams].sort((a, b) => 
                evaluationData.pb[b.id].total - evaluationData.pb[a.id].total
            );
            
            if (sortedTeams.length > 0) {
                const winner = sortedTeams[0];
                const score = evaluationData.pb[winner.id].total;
                document.getElementById('pb-winner-name').textContent = winner.name;
                document.getElementById('pb-winner-score').textContent = `Score: ${score.toFixed(1)}%`;
            }
        }

        function updateNIWinner() {
            const sortedTeams = [...teams].sort((a, b) => 
                evaluationData.ni[b.id].total - evaluationData.ni[a.id].total
            );
            
            if (sortedTeams.length > 0) {
                const winner = sortedTeams[0];
                const score = evaluationData.ni[winner.id].total;
                document.getElementById('ni-winner-name').textContent = winner.name;
                document.getElementById('ni-winner-score').textContent = `Score: ${score.toFixed(1)}%`;
            }
        }

        // Enhanced Charts with Percentages
        function initializeCharts() {
            initializePBChart();
            initializeNIChart();
            initializeComparisonChart();
        }

        function initializePBChart() {
            const ctx = document.getElementById('pb-chart');
            if (!ctx) return;
            
            const context = ctx.getContext('2d');
            if (charts.pb) {
                charts.pb.destroy();
            }
            
            const data = teams.map(team => evaluationData.pb[team.id].total);
            const labels = teams.map(team => team.name);
            
            charts.pb = new Chart(context, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'PB Scores',
                        data: data,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(236, 72, 153, 0.8)'
                        ],
                        borderColor: [
                            'rgb(59, 130, 246)',
                            'rgb(16, 185, 129)',
                            'rgb(139, 92, 246)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)',
                            'rgb(99, 102, 241)',
                            'rgb(236, 72, 153)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            formatter: (value) => value.toFixed(1) + '%',
                            color: 'black',
                            font: {
                                weight: 'bold',
                                size: 10
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function initializeNIChart() {
            const ctx = document.getElementById('ni-chart');
            if (!ctx) return;
            
            const context = ctx.getContext('2d');
            if (charts.ni) {
                charts.ni.destroy();
            }
            
            const data = teams.map(team => evaluationData.ni[team.id].total);
            const labels = teams.map(team => team.name);
            const total = data.reduce((sum, score) => sum + score, 0);
            
            charts.ni = new Chart(context, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'NI Scores',
                        data: data,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(236, 72, 153, 0.8)'
                        ],
                        borderColor: [
                            'rgb(59, 130, 246)',
                            'rgb(16, 185, 129)',
                            'rgb(139, 92, 246)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)',
                            'rgb(99, 102, 241)',
                            'rgb(236, 72, 153)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 10
                                }
                            }
                        },
                        datalabels: {
                            display: false,
                            formatter: (value, context) => {
                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                return percentage + '%';
                            },
                            color: 'white',
                            font: {
                                weight: 'bold',
                                size: 10
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                    return `${label}: ${value.toFixed(1)}% (${percentage}% share)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function initializeComparisonChart() {
            const ctx = document.getElementById('comparisonChart');
            if (!ctx) return;
            
            const context = ctx.getContext('2d');
            if (charts.comparison) {
                charts.comparison.destroy();
            }
            
            charts.comparison = new Chart(context, {
                type: 'bar',
                data: {
                    labels: teams.map(team => team.name),
                    datasets: [
                        {
                            label: 'PB Scores',
                            data: teams.map(team => evaluationData.pb[team.id].total),
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 2
                        },
                        {
                            label: 'NI Scores',
                            data: teams.map(team => evaluationData.ni[team.id].total),
                            backgroundColor: 'rgba(245, 158, 11, 0.8)',
                            borderColor: 'rgb(245, 158, 11)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: 10
                                }
                            }
                        },
                        datalabels: {
                            display: false // Too crowded for comparison chart
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function updateCharts() {
            if (charts.pb) {
                charts.pb.data.datasets[0].data = teams.map(team => evaluationData.pb[team.id].total);
                charts.pb.data.labels = teams.map(team => team.name);
                charts.pb.update();
            }
            
            if (charts.ni) {
                charts.ni.data.datasets[0].data = teams.map(team => evaluationData.ni[team.id].total);
                charts.ni.data.labels = teams.map(team => team.name);
                charts.ni.update();
            }
            
            if (charts.comparison) {
                charts.comparison.data.labels = teams.map(team => team.name);
                charts.comparison.data.datasets[0].data = teams.map(team => evaluationData.pb[team.id].total);
                charts.comparison.data.datasets[1].data = teams.map(team => evaluationData.ni[team.id].total);
                charts.comparison.update();
            }
        }

        // Enhanced Nira Story Bot
        async function getStory() {
            const container = document.getElementById('story-container');
            const text = document.getElementById('story-text');
            const button = document.getElementById('story-button');

            container.style.display = 'flex';
            text.innerHTML = '<i class="fas fa-spinner loading-spinner mr-2"></i>Loading an inspiring story for you...';
            button.disabled = true;

            const availableStories = motivationalStories.filter(story => !usedStories.has(story));
            
            if (availableStories.length === 0) {
                usedStories.clear();
            }

            const selectedStory = availableStories.length > 0 ? 
                availableStories[Math.floor(Math.random() * availableStories.length)] :
                motivationalStories[Math.floor(Math.random() * motivationalStories.length)];
            
            usedStories.add(selectedStory);

            setTimeout(() => {
                text.textContent = selectedStory;
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-star mr-1"></i>Tell me another';
            }, 1500);
        }

        // Enhanced Import/Export Functions
        function exportData(format) {
            const exportData = generateExportData();
            const timestamp = new Date().toISOString().split('T')[0];
            
            if (format === 'json') {
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `NIRA_Evaluation_Export_${timestamp}.json`;
                link.click();
                
                setTimeout(() => URL.revokeObjectURL(link.href), 1000);
                
            } else if (format === 'excel') {
                const wb = XLSX.utils.book_new();
                
                // Teams sheet
                const teamsData = teams.map(team => ({
                    'Team Name': team.name,
                    'Team Lead': team.lead,
                    'Members': team.members.join(', '),
                    'PB Total': evaluationData.pb[team.id].total,
                    'NI Total': evaluationData.ni[team.id].total,
                    'Combined Score': (evaluationData.pb[team.id].total + evaluationData.ni[team.id].total) / 2,
                    'PB Comments': evaluationData.pb[team.id].comments,
                    'NI Comments': evaluationData.ni[team.id].comments
                }));
                const teamsWS = XLSX.utils.json_to_sheet(teamsData);
                XLSX.utils.book_append_sheet(wb, teamsWS, 'Teams Summary');
                
                // PB Detailed scores
                const pbData = teams.map(team => ({
                    'Team': team.name,
                    'Originality': parseFloat(evaluationData.pb[team.id].scores.originality) || 0,
                    'Clarity': parseFloat(evaluationData.pb[team.id].scores.clarity) || 0,
                    'Relevance': parseFloat(evaluationData.pb[team.id].scores.relevance) || 0,
                    'Innovation': parseFloat(evaluationData.pb[team.id].scores.innovation) || 0,
                    'Impact': parseFloat(evaluationData.pb[team.id].scores.impact) || 0,
                    'Total': evaluationData.pb[team.id].total,
                    'Comments': evaluationData.pb[team.id].comments
                }));
                const pbWS = XLSX.utils.json_to_sheet(pbData);
                XLSX.utils.book_append_sheet(wb, pbWS, 'PB Scores');
                
                // NI Detailed scores
                const niData = teams.map(team => ({
                    'Team': team.name,
                    'Quality': parseFloat(evaluationData.ni[team.id].scores.quality) || 0,
                    'Clarity': parseFloat(evaluationData.ni[team.id].scores.clarity) || 0,
                    'Data': parseFloat(evaluationData.ni[team.id].scores.data) || 0,
                    'Recommendations': parseFloat(evaluationData.ni[team.id].scores.recommendations) || 0,
                    'Presentation': parseFloat(evaluationData.ni[team.id].scores.presentation) || 0,
                    'Total': evaluationData.ni[team.id].total,
                    'Comments': evaluationData.ni[team.id].comments
                }));
                const niWS = XLSX.utils.json_to_sheet(niData);
                XLSX.utils.book_append_sheet(wb, niWS, 'NI Scores');
                
                XLSX.writeFile(wb, `NIRA_Evaluation_Export_${timestamp}.xlsx`);
                
            } else if (format === 'csv') {
                const csvData = teams.map(team => ({
                    'Team Name': team.name,
                    'Team Lead': team.lead,
                    'Members': team.members.join('; '),
                    'PB Originality': parseFloat(evaluationData.pb[team.id].scores.originality) || 0,
                    'PB Clarity': parseFloat(evaluationData.pb[team.id].scores.clarity) || 0,
                    'PB Relevance': parseFloat(evaluationData.pb[team.id].scores.relevance) || 0,
                    'PB Innovation': parseFloat(evaluationData.pb[team.id].scores.innovation) || 0,
                    'PB Impact': parseFloat(evaluationData.pb[team.id].scores.impact) || 0,
                    'PB Total': evaluationData.pb[team.id].total,
                    'PB Comments': evaluationData.pb[team.id].comments,
                    'NI Quality': parseFloat(evaluationData.ni[team.id].scores.quality) || 0,
                    'NI Clarity': parseFloat(evaluationData.ni[team.id].scores.clarity) || 0,
                    'NI Data': parseFloat(evaluationData.ni[team.id].scores.data) || 0,
                    'NI Recommendations': parseFloat(evaluationData.ni[team.id].scores.recommendations) || 0,
                    'NI Presentation': parseFloat(evaluationData.ni[team.id].scores.presentation) || 0,
                    'NI Total': evaluationData.ni[team.id].total,
                    'NI Comments': evaluationData.ni[team.id].comments,
                    'Combined Score': (evaluationData.pb[team.id].total + evaluationData.ni[team.id].total) / 2
                }));
                
                const ws = XLSX.utils.json_to_sheet(csvData);
                const csvOutput = XLSX.utils.sheet_to_csv(ws);
                
                const dataBlob = new Blob([csvOutput], { type: 'text/csv' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `NIRA_Evaluation_Export_${timestamp}.csv`;
                link.click();
                
                setTimeout(() => URL.revokeObjectURL(link.href), 1000);
            }
            
            // Hide dropdown
            document.getElementById('export-options').classList.remove('show');
            
            alert(`Data exported successfully in ${format.toUpperCase()} format!`);
        }

        function importData(format) {
            const fileInput = document.getElementById('file-input');
            fileInput.accept = format === 'json' ? '.json' : format === 'excel' ? '.xlsx' : '.csv';
            fileInput.click();
            
            // Hide dropdown
            document.getElementById('import-options').classList.remove('show');
        }

        function generateExportData() {
            return {
                teams: teams.map(team => ({
                    ...team,
                    pbScores: evaluationData.pb[team.id].scores,
                    pbTotal: evaluationData.pb[team.id].total,
                    pbComments: evaluationData.pb[team.id].comments,
                    niScores: evaluationData.ni[team.id].scores,
                    niTotal: evaluationData.ni[team.id].total,
                    niComments: evaluationData.ni[team.id].comments
                })),
                evaluationData: evaluationData,
                exportDate: new Date().toISOString(),
                evaluationMonth: document.getElementById('evaluation-month-display').textContent,
                pbEvaluator: document.getElementById('pb-evaluator-name').value,
                niEvaluator: document.getElementById('ni-evaluator-name').value,
                evaluationDate: document.getElementById('evaluation-date').value,
                metadata: {
                    totalTeams: teams.length,
                    avgPBScore: teams.reduce((sum, team) => sum + evaluationData.pb[team.id].total, 0) / teams.length,
                    avgNIScore: teams.reduce((sum, team) => sum + evaluationData.ni[team.id].total, 0) / teams.length
                }
            };
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    if (file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                        
                        if (data.teams) {
                            teams = data.teams.map(team => ({
                                id: team.id || 'team_' + Date.now(),
                                name: team.name || 'Unknown Team',
                                lead: team.lead || 'Unknown Lead',
                                members: team.members || [],
                                color: team.color || 'blue',
                                pbScores: team.pbScores || {},
                                pbTotal: team.pbTotal || 0,
                                pbComments: team.pbComments || '',
                                niScores: team.niScores || {},
                                niTotal: team.niTotal || 0,
                                niComments: team.niComments || ''
                            }));

                            evaluationData = { pb: {}, ni: {} };
                            teams.forEach(team => {
                                evaluationData.pb[team.id] = {
                                    scores: team.pbScores || { originality: '', clarity: '', relevance: '', innovation: '', impact: '' },
                                    total: team.pbTotal || 0,
                                    comments: team.pbComments || ''
                                };
                                evaluationData.ni[team.id] = {
                                    scores: team.niScores || { quality: '', clarity: '', data: '', recommendations: '', presentation: '' },
                                    total: team.niTotal || 0,
                                    comments: team.niComments || ''
                                };
                            });
                        }
                        
                        if (data.evaluationMonth) {
                            document.getElementById('evaluation-month-display').textContent = data.evaluationMonth;
                        }
                        if (data.pbEvaluator) {
                            document.getElementById('pb-evaluator-name').value = data.pbEvaluator;
                        }
                        if (data.niEvaluator) {
                            document.getElementById('ni-evaluator-name').value = data.niEvaluator;
                        }
                        if (data.evaluationDate) {
                            document.getElementById('evaluation-date').value = data.evaluationDate;
                        }

                        refreshInterface();
                        alert('JSON data imported successfully!');
                        
                    } else if (file.name.endsWith('.xlsx')) {
                        const workbook = XLSX.read(e.target.result, { type: 'array' });
                        
                        // Try to read from Teams Summary sheet
                        if (workbook.SheetNames.includes('Teams Summary')) {
                            const worksheet = workbook.Sheets['Teams Summary'];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet);
                            
                            // Update teams based on Excel data
                            jsonData.forEach((row, index) => {
                                if (teams[index]) {
                                    teams[index].name = row['Team Name'] || teams[index].name;
                                    teams[index].lead = row['Team Lead'] || teams[index].lead;
                                    teams[index].members = row['Members'] ? row['Members'].split(', ') : teams[index].members;
                                    
                                    evaluationData.pb[teams[index].id].total = parseFloat(row['PB Total']) || 0;
                                    evaluationData.ni[teams[index].id].total = parseFloat(row['NI Total']) || 0;
                                    evaluationData.pb[teams[index].id].comments = row['PB Comments'] || '';
                                    evaluationData.ni[teams[index].id].comments = row['NI Comments'] || '';
                                }
                            });
                            
                            refreshInterface();
                            alert('Excel data imported successfully!');
                        } else {
                            alert('Excel file format not recognized. Please use exported Excel format.');
                        }
                        
                    } else if (file.name.endsWith('.csv')) {
                        const workbook = XLSX.read(e.target.result, { type: 'array' });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        // Update teams based on CSV data
                        jsonData.forEach((row, index) => {
                            if (teams[index]) {
                                teams[index].name = row['Team Name'] || teams[index].name;
                                teams[index].lead = row['Team Lead'] || teams[index].lead;
                                teams[index].members = row['Members'] ? row['Members'].split('; ') : teams[index].members;
                                
                                // Update PB scores
                                evaluationData.pb[teams[index].id].scores = {
                                    originality: row['PB Originality'] || '',
                                    clarity: row['PB Clarity'] || '',
                                    relevance: row['PB Relevance'] || '',
                                    innovation: row['PB Innovation'] || '',
                                    impact: row['PB Impact'] || ''
                                };
                                evaluationData.pb[teams[index].id].total = parseFloat(row['PB Total']) || 0;
                                evaluationData.pb[teams[index].id].comments = row['PB Comments'] || '';
                                
                                // Update NI scores
                                evaluationData.ni[teams[index].id].scores = {
                                    quality: row['NI Quality'] || '',
                                    clarity: row['NI Clarity'] || '',
                                    data: row['NI Data'] || '',
                                    recommendations: row['NI Recommendations'] || '',
                                    presentation: row['NI Presentation'] || ''
                                };
                                evaluationData.ni[teams[index].id].total = parseFloat(row['NI Total']) || 0;
                                evaluationData.ni[teams[index].id].comments = row['NI Comments'] || '';
                            }
                        });
                        
                        refreshInterface();
                        alert('CSV data imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing file: ' + error.message);
                    console.error('Import error:', error);
                }
            };

            if (file.name.endsWith('.json')) {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }

            event.target.value = '';
        }

        function refreshInterface() {
            populateTeamTables();
            updateCharts();
            updateMedalRankings();
            updateScoreSummaryBoxes();
            updateFinalSummaryBoxes();
            updateWinnerCards();
            updateMedalWinnersDisplay();
        }
    </script>
</body>
</html>
